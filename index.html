<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>a-REA</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<link rel="preload" as="image" href="icons/IMG_1194-removebg-preview.png">
<link rel="preload" as="image" href="icons/IMG_1193.jpeg">

<link rel="apple-touch-icon" href="icons/apple-touch-icon-iphone-60x60.png">
<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-touch-icon-ipad-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-touch-icon-iphone-retina-120x120.png"> 
<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-touch-icon-ipad-retina-152x152.png">

<style>
:root {
  /* Richer Dark Mode Background */
  --bg-dark: #050507;
  --text-main: #ffffff;
  --text-mute: rgba(255, 255, 255, 0.55);
  --accent: #007AFF; 
  --accent-glow: rgba(0, 122, 255, 0.4);
  
  --liquid-glass-bg: rgba(255, 255, 255, 0.08);
  --liquid-glass-border: rgba(255, 255, 255, 0.15);
  --liquid-glass-shine: rgba(255, 255, 255, 0.25);
  --glass-shadow: 0 20px 40px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.1);
  --ui-zoom: 0.95;
  
  --nav-bg: rgba(15, 15, 18, 0.65);
  --pill-bg: var(--accent);
  --pill-border: rgba(255, 255, 255, 0.3);
  --player-bg: rgba(15, 15, 18, 0.85);
  
  /* Smoothed out Spring Physics - Less bouncy, more premium */
  --spring-bounce: cubic-bezier(0.2, 0.8, 0.3, 1.1);
  --spring-smooth: cubic-bezier(0.25, 1, 0.5, 1);
}

body.light {
  /* Cleaner Light Mode */
  --bg-dark: #f4f5f8;
  --text-main: #111111;
  --text-mute: rgba(0, 0, 0, 0.5);
  --accent-glow: rgba(0, 122, 255, 0.3);
  
  --liquid-glass-bg: rgba(255, 255, 255, 0.65);
  --liquid-glass-border: rgba(0, 0, 0, 0.08);
  --liquid-glass-shine: rgba(255, 255, 255, 1);
  --glass-shadow: 0 15px 35px rgba(0,0,0,0.05), inset 0 1px 0 rgba(255,255,255,1);
  --nav-bg: rgba(250, 250, 252, 0.85);
  --pill-bg: var(--accent);
  --pill-border: rgba(0, 0, 0, 0.1);
  --player-bg: rgba(255, 255, 255, 0.9);
}

body {
  margin: 0;
  background-color: var(--bg-dark);
  color: var(--text-main);
  font-family: 'Inter', 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  overflow-x: hidden;
  min-height: 100vh;
  transition: background-color 0.4s var(--spring-smooth), color 0.4s var(--spring-smooth), background 0.4s ease;
}

#app-wrapper {
  transform: scale(var(--ui-zoom));
  transform-origin: top center;
  width: calc(100% / var(--ui-zoom));
  min-height: 100vh;
  padding-bottom: 160px;
  transition: padding-left 0.4s var(--spring-smooth), filter 0.4s ease;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body.theater-mode #app-wrapper {
    background: rgba(0,0,0,0.85);
}
body.theater-mode .glass-card:not(.theater-focus) {
    opacity: 0.1;
    pointer-events: none;
    filter: blur(5px);
}
.theater-focus {
    z-index: 100;
    position: relative;
    box-shadow: 0 0 50px rgba(0,0,0,0.8) !important;
}

h1 {
  font-size: 3rem; 
  font-weight: 900;
  letter-spacing: -0.04em;
  margin-bottom: 30px;
  text-align: left;
  background: linear-gradient(135deg, var(--text-main), var(--text-mute));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: textFadeIn 0.6s var(--spring-smooth) forwards;
}

@keyframes textFadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

section {
  display: none;
  padding: 40px 5%;
  max-width: 1000px;
  margin: 0 auto;
  animation: pageEnter 0.5s var(--spring-bounce);
  content-visibility: auto; 
}
section.active { display: block; }

@keyframes pageEnter {
  from { opacity: 0; transform: scale(0.96) translateY(20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.wix-iframe { will-change: transform, width; }

#glassCanvas {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  z-index: -1;
  filter: blur(80px) saturate(160%);
  opacity: 0.85;
  transition: opacity 0.5s;
  will-change: opacity, transform;
}

.glass-card {
  background: var(--liquid-glass-bg);
  backdrop-filter: blur(40px);
  -webkit-backdrop-filter: blur(40px);
  border: 1px solid var(--liquid-glass-border);
  border-top: 1px solid var(--liquid-glass-shine);
  border-radius: 28px;
  padding: 28px;
  margin-bottom: 24px;
  box-shadow: var(--glass-shadow);
  cursor: default;
  transition: transform 0.3s var(--spring-bounce), box-shadow 0.3s ease, border-color 0.3s ease, opacity 0.3s;
  position: relative;
  overflow: hidden;
}

.glass-card:hover {
  border-color: color-mix(in srgb, var(--accent) 40%, var(--liquid-glass-border));
  box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 40px var(--accent-glow);
}

.glass-card.clickable:active, .btn-ios:active, .song-item:active { 
    transform: scale(0.97); 
}

.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 24px;
}
@media (min-width: 900px) {
    .side-by-side-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: start;
    }
}

.search-wrapper { position: relative; margin-bottom: 30px; width: 100%; }

.search-input {
  width: 100%;
  padding: 18px 20px 18px 50px;
  border-radius: 24px;
  font-family: inherit;
  font-weight: 500;
  font-size: 17px;
  color: var(--text-main);
  outline: none;
  transition: all 0.3s var(--spring-smooth);
  background: var(--liquid-glass-bg) !important;
  backdrop-filter: blur(30px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(30px) saturate(180%) !important;
  border: 1px solid var(--liquid-glass-border) !important;
  border-top: 1px solid var(--liquid-glass-shine) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}

.search-input:focus {
  border-color: var(--accent) !important;
  box-shadow: 0 0 25px var(--accent-glow), 0 10px 30px rgba(0,0,0,0.1);
  transform: scale(1.01);
}

.search-icon-inside {
  position: absolute; left: 18px; top: 50%; transform: translateY(-50%);
  width: 22px; height: 22px; color: var(--text-main); opacity: 0.6; z-index: 2; pointer-events: none;
}

.song-item {
  display: flex; flex-direction: column; padding: 16px 10px; border-bottom: 1px solid var(--liquid-glass-border); min-height: 110px; 
  transition: background 0.2s, transform 0.2s var(--spring-bounce), border-radius 0.2s;
}
.song-item:hover {
    background: rgba(255,255,255,0.05);
    border-radius: 16px;
    border-bottom-color: transparent;
}
.song-item:last-child { border-bottom: none; }

.visualizer { display: flex; align-items: flex-end; height: 20px; gap: 4px; width: 34px; }
.bar { width: 4px; background: var(--text-mute); border-radius: 2px; transition: height 0.1s ease, background 0.3s; flex-shrink: 0; }
.visualizer.active .bar { background: var(--accent); animation: bounce 0.4s infinite alternate; }
.bar:nth-child(1) { height: 6px; animation-delay: 0.1s; }
.bar:nth-child(2) { height: 10px; animation-delay: 0.3s; }
.bar:nth-child(3) { height: 8px; animation-delay: 0.0s; }
.bar:nth-child(4) { height: 5px; animation-delay: 0.2s; }

@keyframes bounce { from { height: 4px; } to { height: 16px; } }

.song-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; pointer-events: none;}
.song-title { font-weight: 700; font-size: 16px; display: block; transition: color 0.3s; letter-spacing: -0.01em;}
.song-title.playing { color: var(--accent); }

audio { width: 100%; height: 44px; border-radius: 22px; margin-bottom: 10px; outline: none; }
audio::-webkit-media-controls-panel { background: rgba(255,255,255,0.1); }
body.light audio::-webkit-media-controls-panel { background: rgba(0,0,0,0.05); }

video { width: 100%; border-radius: 20px; border: 1px solid var(--liquid-glass-border); background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);}

.btn-ios {
  display: block; width: 100%; padding: 18px; 
  background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 80%, white));
  color: #fff; text-decoration: none; border-radius: 20px; text-align: center;
  font-weight: 700; font-size: 17px; margin-bottom: 20px; border: none; cursor: pointer;
  box-shadow: 0 10px 20px var(--accent-glow);
  transition: transform 0.2s var(--spring-bounce), box-shadow 0.2s;
  font-family: inherit;
}
.btn-ios:active { transform: scale(0.95); box-shadow: 0 5px 10px var(--accent-glow); }

.toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid var(--liquid-glass-border); }
.toggle-row:last-child { border-bottom: none; }
.toggle-label { font-size: 17px; font-weight: 600; }

input[type="range"] { width: 150px; accent-color: var(--accent); }
input[type="checkbox"] { width: 24px; height: 24px; accent-color: var(--accent); border-radius: 8px; cursor: pointer; transition: transform 0.2s var(--spring-bounce);}
input[type="checkbox"]:active { transform: scale(0.8); }
input[type="color"] { cursor: pointer; outline: none; }

.setting-select {
  background: var(--liquid-glass-bg); color: var(--text-main); border: 1px solid var(--liquid-glass-border);
  border-radius: 14px; padding: 10px 16px; font-size: 15px; font-weight: 600; outline: none; 
  backdrop-filter: blur(10px); -webkit-appearance: none; font-family: inherit; cursor: pointer;
}
.setting-select option { background: var(--bg-dark); color: var(--text-main); }

.iframe-wrapper {
  height: 80vh; padding: 0; overflow: hidden; border-radius: 28px; position: relative;
  background: transparent; display: flex; justify-content: center; align-items: flex-start;
}
.wix-iframe {
  border: none; position: absolute; top: 0; left: 0; transform-origin: top left;
  transition: transform 0.4s var(--spring-smooth), width 0.4s ease;
}

/* REVOLUTIONIZED NAVIGATION BAR */
.nav-container {
  position: fixed; 
  bottom: 30px; left: 50%; transform: translateX(-50%);
  width: 95vw; max-width: 500px; 
  display: flex; align-items: center; justify-content: flex-start;
  padding: 10px; z-index: 9999; background: var(--nav-bg);
  backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
  border-radius: 40px; border: 1px solid var(--liquid-glass-border);
  box-shadow: 0 20px 50px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  transition: all 0.4s var(--spring-smooth);
  
  overflow-x: auto; 
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none; 
  gap: 5px;
}
.nav-container::-webkit-scrollbar { display: none; }

.nav-item {
  position: relative; background: none; border: none;
  width: clamp(44px, 12vw, 56px); height: clamp(44px, 12vw, 56px);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: color 0.3s, transform 0.2s var(--spring-bounce); color: var(--text-mute); z-index: 2;
  flex-shrink: 0; border-radius: 50%;
}
.nav-item:active { transform: scale(0.88); }

.nav-item.active { color: #ffffff; }
svg { width: 26px; height: 26px; fill: currentColor; transition: transform 0.2s var(--spring-bounce); }
.nav-item:hover svg { transform: scale(1.1); }

/* Updated Icon Image class */
.nav-icon-img {
  width: 26px; height: 26px; object-fit: contain; flex-shrink: 0;
  transition: transform 0.2s var(--spring-bounce);
}
.nav-item:hover .nav-icon-img { transform: scale(1.1); }

.nav-selection-pill {
  position: absolute; left: 0; top: 0;
  background: var(--pill-bg); 
  box-shadow: 0 5px 15px var(--accent-glow);
  border: 1px solid var(--pill-border); border-radius: 30px; z-index: 1;
  transition: all 0.4s var(--spring-bounce); pointer-events: none;
  will-change: transform, width, height;
}

/* DESKTOP/IPAD SIDE NAV */
@media (min-width: 850px) {
  #app-wrapper { padding-left: 100px; padding-bottom: 50px; }
  
  .nav-container {
    bottom: auto; top: 50%; left: 30px; transform: translateY(-50%);
    width: 76px; height: auto; flex-direction: column; gap: 12px;
    padding: 20px 10px; border-radius: 38px;
    align-items: flex-start; overflow: hidden; 
  }
  
  .nav-container:hover {
    width: 220px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.4);
  }
  
  .nav-item svg, .nav-item img {
      display: block !important;
      width: 26px; height: 26px; flex-shrink: 0;
  }
  
  .nav-item {
    width: 100%; height: 56px; justify-content: flex-start; padding-left: 15px; border-radius: 20px;
  }
  
  .nav-item::after {
    content: attr(data-label);
    font-family: 'Inter', sans-serif;
    font-weight: 700; font-size: 16px;
    opacity: 0; margin-left: 15px; 
    transition: opacity 0.3s ease;
    white-space: nowrap; pointer-events: none;
  }
  
  .nav-container:hover .nav-item::after { opacity: 1; }
  
  section { max-width: 1200px; }
}

#miniPlayer {
  position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%) scale(0.9);
  width: 90%; max-width: 400px; background: var(--player-bg);
  backdrop-filter: blur(35px); -webkit-backdrop-filter: blur(35px);
  border: 1px solid var(--liquid-glass-border); border-radius: 24px; padding: 14px 24px;
  display: flex; align-items: center; justify-content: space-between;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3); z-index: 900; opacity: 0; pointer-events: none;
  transition: all 0.5s var(--spring-bounce);
}
#miniPlayer.show { bottom: 110px; opacity: 1; pointer-events: auto; transform: translateX(-50%) scale(1); }

@media (min-width: 850px) {
  #miniPlayer { bottom: 30px; left: calc(50% + 50px); }
  #miniPlayer.show { bottom: 30px; }
}

.mp-info { display: flex; flex-direction: column; overflow: hidden; }
.mp-title { font-weight: 700; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-main); }
.mp-status { font-size: 12px; color: var(--accent); font-weight: 600; margin-top: 2px; }
.mp-controls { display: flex; gap: 15px; align-items: center; }
.mp-btn { background: none; border: none; padding: 0; cursor: pointer; color: var(--text-main); display: flex; align-items: center; justify-content: center; transition: transform 0.2s var(--spring-bounce);}
.mp-btn:active { transform: scale(0.8); }

.ultra-wide-section { max-width: 98% !important; padding: 20px !important; margin: 0 auto; }
.btn-ios-large { display: block; width: 100%; max-width: 600px; margin: 0 auto 40px auto; padding: 24px; background: var(--accent); color: white; text-align: center; text-decoration: none; border-radius: 24px; font-weight: 800; font-size: 20px; box-shadow: 0 15px 30px var(--accent-glow); font-family: inherit;}
.ultra-grid { display: grid; grid-template-columns: 1fr; gap: 30px; width: 100%; }
@media (min-width: 850px) { .ultra-grid { grid-template-columns: 1fr 1fr; } }

.game-container-giant {
  height: 700px; padding: 0 !important; border-radius: 32px !important; display: flex; flex-direction: column; overflow: hidden;
  background: var(--liquid-glass-bg); border: 1px solid var(--liquid-glass-border); transition: all 0.4s var(--spring-smooth);
}
body.ipad-mode .game-container-giant { height: 800px; }

.game-ui-header { padding: 18px 25px; background: rgba(0,0,0,0.4); display: flex; align-items: center; gap: 15px; cursor: pointer; backdrop-filter: blur(20px);}
.status-dot { width: 12px; height: 12px; background: #34C759; border-radius: 50%; box-shadow: 0 0 12px #34C759; }
.game-label { font-weight: 800; letter-spacing: 1px; flex-grow: 1; color: #fff; font-size: 15px;}
.expand-trigger { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 14px; cursor: pointer; transition: background 0.2s, transform 0.2s var(--spring-bounce);}
.expand-trigger:hover { background: rgba(255,255,255,0.25); transform: scale(1.1); }

.game-viewport { flex-grow: 1; background: #000; position: relative; overflow: hidden; }
.game-iframe { border: none; position: absolute; top: 0; left: 0; transform-origin: top left; width: 100%; height: 100%; transition: opacity 0.3s; }
.game-container-giant.is-active-fs { position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 999999 !important; border-radius: 0 !important; margin: 0 !important; }

body.solid-glass * { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; }
body.solid-glass .glass-card, body.solid-glass .nav-container, body.solid-glass #miniPlayer { 
    background: var(--player-bg) !important; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.15); 
    border: 1px solid rgba(0,0,0,0.05);
}

body.ultra-saver .glass-card, body.ultra-saver .nav-container { box-shadow: none !important; }
body.ultra-saver *, body.ultra-saver *:before, body.ultra-saver *:after { transition: none !important; animation: none !important; }
body.no-bg #glassCanvas { display: none !important; }

.theater-btn {
    margin-top: 15px; background: rgba(255,255,255,0.1); border: 1px solid var(--liquid-glass-border);
    color: var(--text-main); border-radius: 14px; padding: 10px 15px; font-weight: 600; cursor: pointer;
    transition: transform 0.2s var(--spring-bounce);
}
.theater-btn:active { transform: scale(0.9); }
</style>
</head>
<body class="light ipad-mode">

<canvas id="glassCanvas" width="1440" height="865"></canvas>

<div id="miniPlayer">
  <div class="mp-info">
    <span class="mp-title" id="mpTitle">Not Playing</span>
    <span class="mp-status">Now Playing</span>
  </div>
  <div class="mp-controls">
    <button class="mp-btn" onclick="togglePlay()">
      <svg id="mpPlayIcon" viewBox="0 0 24 24" width="28" height="28"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    </button>
  </div>
</div>

<div class="nav-container" id="mainNav">
 <div id="selectionPill" class="nav-selection-pill"></div>
  <button class="nav-item active" data-label="Home" onclick="showTab('home', this)"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg></button>
  <button class="nav-item airea-nav-btn" data-label="ai-REA" onclick="showTab('ai-rea', this)">
    <img src="icons/IMG_1194-removebg-preview.png" alt="ai-REA" class="nav-icon-img">
  </button>
  <button class="nav-item" data-label="Songs" onclick="showTab('songs', this)"><svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"></path></svg></button>
  <button class="nav-item" data-label="Videos" onclick="showTab('videos', this)"><svg viewBox="0 0 24 24"><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg></button>
  <button class="nav-item" data-label="Games" onclick="showTab('games', this)">
    <svg viewBox="0 0 24 24">
      <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm7 2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-3-3c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path>
    </svg>
  </button>
  <button class="nav-item" data-label="Library" onclick="showTab('books', this)"><svg viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path></svg></button>
  <button class="nav-item" data-label="Community" onclick="showTab('community', this)">
    <svg viewBox="0 0 24 24"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></svg>
  </button>
  <button class="nav-item" data-label="Settings" onclick="showTab('settings', this)">
    <svg viewBox="0 0 24 24">
      <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
    </svg>
  </button>
</div>

<div id="app-wrapper">

<section id="home" class="active">
  <div class="glass-card clickable" style="border-left: 6px solid var(--accent);" onclick="openAlexModal()">
    <strong style="color:var(--accent); font-size: 1.1rem;">Alexandru News</strong><br>
    <span style="font-size: 15px; opacity: 0.85; display: inline-block; margin-top: 6px;">Click here to find out about Alexandru and why I'm committing to his legacy!</span>
  </div>

  <div class="glass-card iframe-wrapper" id="wixWrapper">
    <iframe id="wixFrame" class="wix-iframe" src="https://aqeelchy02.wixsite.com/a-rea" style="width: 375px; height: 25.951557%; transform: scale(0);" loading="lazy" fetchpriority="low"></iframe>
  </div>
</section>

<section id="ai-rea">
    <div style="max-width: 900px; margin: 0 auto 10px auto;">
        <h2 style="color: var(--text-main); font-size: 1.4rem; font-weight: 700;"></h2>
    </div>

    <div class="glass-card" style="padding: 0; overflow: hidden; max-width: 900px; margin: 20px auto;">
        
        <div style="width: 100%; overflow: hidden;">
            <img src="icons/IMG_1193.jpeg" 
                alt="Section Banner" 
                style="width: 100%; height: auto; display: block; object-fit: cover; pointer-events: none; border-bottom: 1px solid var(--liquid-glass-border);">
        </div>

        <iframe
            src="https://ai-rea-ai-rea.hf.space"
            frameborder="0"
            width="100%"
            height="1500"
            style="display: block; background: transparent;"
            title="ai-REA"
            loading="lazy">
        </iframe> 
    </div>
</section>

<section id="songs">
  <h1>Musical Story</h1>

  <div class="search-wrapper">
    <svg class="search-icon-inside" viewBox="0 0 24 24">
      <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    </svg>
    <input type="text" class="search-input" placeholder="Search Songs..." oninput="filterSongs(this.value)">
  </div>

  <div class="glass-card side-by-side-container">
    <div style="width:100%;">
        <div class="song-item" onclick="triggerDynamicTheming('#007AFF')">
          <div class="song-header">
            <span class="song-title">01 – a-REA (Original)</span>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          </div>
          <audio controls="" src="audio/01 - Aqeel Ahmed Choudhury - a-REA.mp3"></audio>
        </div>

        <div class="song-item" onclick="triggerDynamicTheming('#FF2D55')">
          <div class="song-header">
            <span class="song-title">02 – L-INE GRAPHS!</span>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          </div>
          <audio controls="" src="audio/02 - Aqeel Ahmed Choudhury - L-INE GRAPHS!.mp3"></audio>
        </div>

        <div class="song-item" onclick="triggerDynamicTheming('#FF9500')">
          <div class="song-header">
            <span class="song-title">03 – T-ABLES!!</span>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          </div>
          <audio controls="" src="audio/03 - Aqeel Ahmed Choudhury - T-ABES!!.mp3"></audio>
        </div>
    </div>
    
    <div style="width:100%;">
        <div class="song-item" onclick="triggerDynamicTheming('#34C759')">
          <div class="song-header">
            <span class="song-title">04 – T-IMETABLES!!</span>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          </div>
          <audio controls="" src="audio/04 - Aqeel Ahmed Choudhury - T-IMETABLES!!!.mp3"></audio>
        </div>

        <div class="song-item" onclick="triggerDynamicTheming('#AF52DE')">
          <div class="song-header">
            <span class="song-title">05 – A-NGLES!!!!</span>
            <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          </div>
          <audio controls="" src="audio/05 - Aqeel Ahmed Choudhury - A-NGLES!!!!.mp3"></audio>
        </div>

        <div style="margin-top:20px; padding-top:10px; border-top: 1px solid var(--liquid-glass-border);">
          <div class="song-item" onclick="triggerDynamicTheming('#5AC8FA')">
            <div class="song-header">
              <span class="song-title" style="color:var(--accent)">Bonus – a-REA Revamp</span>
              <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </div>
            <audio controls="" src="audio/aREAREVAMP.m4a"></audio>
          </div>
          <div class="song-item" onclick="triggerDynamicTheming('#FFCC00')">
            <div class="song-header">
              <span class="song-title">NEW – MASTER</span>
              <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </div>
            <audio controls="" src="Music/MASTER.m4a"></audio>
          </div>
          <div class="song-item" onclick="triggerDynamicTheming('#FF3B30')">
            <div class="song-header">
              <span class="song-title">FAN FAVOURITE – TINY</span>
              <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </div>
            <audio controls="" src="audio/Tiny.m4a"></audio>
          </div>
        </div>
    </div>
  </div>
</section>

<section id="videos">
  <h1>Videos</h1>
  <div class="card-grid">
    <div class="glass-card" style="padding: 20px;">
      <div class="song-title" style="margin-bottom: 12px;">aq.co direct - a-REA 2.0</div>
      <video controls="" src="https://www.dropbox.com/scl/fi/kvyqipeicp9iw4jwq743f/aq.co-direct-a-REA-2.0-07.05.2025.mp4?rlkey=mt0h8e3x16sltw6jvm1a3lyfg&amp;raw=1" preload="none"></video>
      <button class="theater-btn" onclick="toggleTheaterMode(this)">Enter Theater Mode</button>
    </div>
    <div class="glass-card" style="padding: 20px;">
      <div class="song-title" style="margin-bottom: 12px;">a-REA APP Official Trailer</div>
      <video controls="" src="https://www.dropbox.com/scl/fi/up1gt8pr9oa5koke2fkkg/DC09AB20-3D0B-469D-824D-621EB1418B48.mov?rlkey=z71n7ce7mlzlg2nmewstv0ejn&st=ilsw0ker&raw=1" preload="none"></video>
      <button class="theater-btn" onclick="toggleTheaterMode(this)">Enter Theater Mode</button>
    </div>
  </div>
</section>

<section id="games" class="ultra-wide-section">
  <h1>Games</h1>
  <a href="https://www.roblox.com/games/70684065412187/a-REA-HANGOUT" class="btn-ios-large">LAUNCH a-REA HANGOUT</a>
  
  <div class="ultra-grid">
    <div class="glass-card game-container-giant max-power">
      <div class="game-ui-header" onclick="setMaxPower(this)">
        <div class="status-dot"></div>
        <span class="game-label">MASTER</span>
        <button class="expand-trigger" onclick="handleFullscreen(this); event.stopPropagation();">
          <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" stroke-width="2.5" fill="none"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
        </button>
      </div>
      <div class="game-viewport">
        <iframe src="file.html" class="game-iframe" data-virtual-width="1200" loading="lazy"></iframe>
      </div>
    </div>

    <div class="glass-card game-container-giant">
      <div class="game-ui-header" onclick="setMaxPower(this)">
        <div class="status-dot"></div>
        <span class="game-label">TINY DASH</span>
        <button class="expand-trigger" onclick="handleFullscreen(this); event.stopPropagation();">
          <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" stroke-width="2.5" fill="none"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
        </button>
      </div>
      <div class="game-viewport">
        <iframe src="tiny.html" class="game-iframe" data-virtual-width="1200" loading="lazy"></iframe>
      </div>
    </div>
  </div>
  <script>
    function setMaxPower(headerElement) {
      document.querySelectorAll('.game-container-giant').forEach(c => c.classList.remove('max-power'));
      headerElement.closest('.game-container-giant').classList.add('max-power');
    }

    function handleFullscreen(btn) {
      const card = btn.closest('.game-container-giant');
      setMaxPower(card.querySelector('.game-ui-header'));
      
      const isNowFull = card.classList.toggle('is-active-fs');
      if (isNowFull) { document.body.style.overflow = 'hidden'; }
      else { document.body.style.overflow = ''; }
      if (typeof scaleGameIframes === 'function') {
        setTimeout(scaleGameIframes, 10);
        setTimeout(scaleGameIframes, 300);
      }
    }
    setTimeout(() => { if (typeof scaleGameIframes === 'function') scaleGameIframes(); }, 500);
  </script>
</section>

<section id="books">
  <h1>Library</h1>
  
  <div class="card-grid">
      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/5fac1c0a65.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/f2ny0p7u6eai9dtqlu8vn/Trash.pdf?rlkey=z3410okcjoxwysje6dvkgt3im&st=yc0svifc&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Trash
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/5b6763ab02.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/jbxyot1tvss95wmy8oqsp/Skellig.pdf?rlkey=zw8p0z9eatsacec76omwdkoko&st=wi7kelpx&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Skellig
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/b54f74f734.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/nanpzpw19wlnfniq5r1bj/Who-Let-The-Gods-Out.pdf?rlkey=o7bjbg8wn4utz13la6hf1vc8q&st=8nypr58y&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Who Let The Gods Out
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/186f2ad6d1.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/j5ueqmsrzjckzbhgayjen/Simply-The-Quest.pdf?rlkey=vxwebvosureyb5czjj4hbp234&st=y37hii41&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Simply The Quest
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/692e21bd2c.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/su16gjex59vbkxou4uamc/Beyond-The-Odyssey.pdf?rlkey=4grk0yo86jt3nevrpdnhnr5pl&st=quahh8l8&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Beyond The Odyssey
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/d6a4f96fb4.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/3e4guvjpensetwua192hc/Against-All-Gods.pdf?rlkey=8nuhm2kodofft3z1stjvzkywr&st=o2f7wrud&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Against All Gods
        </a>
      </div>

      <div class="glass-card" style="padding: 16px; height: 500px; display: flex; flex-direction: column; gap: 16px;">
        <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/8db12c93ef.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: transparent;" loading="lazy"></iframe>
        <a href="https://www.dropbox.com/scl/fi/gm1mn4d0rmjjrmcp5xblo/My-Name-Is-Mina.pdf?rlkey=amdwrin5ice6g4emxbhi95kqz&st=4xuzwdj9&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 14px;">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> My Name Is Mina
        </a>
      </div>
  </div>
</section>

<section id="community">
    <h1>a-REA Community</h1>
    <div class="glass-card">
        <div style="margin-bottom: 20px;">
            <label style="display:block; margin-bottom:10px; font-weight:700; color:var(--text-mute); font-size:14px; text-transform:uppercase; letter-spacing: 1px;">Username</label>
            <input type="text" id="username" placeholder="Enter your name..." class="search-input">
        </div>
        <div style="margin-bottom: 20px;">
            <label style="display:block; margin-bottom:10px; font-weight:700; color:var(--text-mute); font-size:14px; text-transform:uppercase; letter-spacing: 1px;">Message</label>
            <textarea id="message" rows="3" placeholder="What's on your mind?" class="search-input" style="height: auto; resize: none;"></textarea>
        </div>
        <button id="postBtn" class="btn-ios">Post Comment</button>
    </div>

    <div id="commentsContainer" style="display: flex; flex-direction: column; gap: 20px;">
        <div style="text-align: center; padding: 40px; color: var(--text-mute); font-weight: 600;">Loading comments...</div>
    </div>
</section>

<section id="settings">
  <h1>Settings</h1>
  <div class="glass-card">
    <div class="toggle-row">
        <span class="toggle-label">Moods</span>
        <select id="themeSelect" class="setting-select" onchange="updateThemeSelection(this.value)">
            <option value="default">Default (Blue)</option>
            <option value="sunset">Sunset (Orange)</option>
            <option value="forest">Forest (Green)</option>
            <option value="ocean">Ocean (Deep Blue)</option>
            <option value="midnight">Midnight (Purple)</option>
            <option value="custom">Custom Color</option>
        </select>
    </div>
    
    <div id="customThemeSettings" style="display: none; flex-direction: column; gap: 15px; padding: 20px; background: rgba(0,0,0,0.05); border-radius: 16px; margin-bottom: 20px; border: 1px solid var(--liquid-glass-border);">
        <div class="toggle-row" style="padding: 0; border: none;">
            <span class="toggle-label" style="font-size: 15px;">Background Shade 1</span>
            <input type="color" id="customBg1Picker" oninput="updateCustomTheme()" value="#050507" style="width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer; background: transparent;">
        </div>
        <div class="toggle-row" style="padding: 0; border: none;">
            <span class="toggle-label" style="font-size: 15px;">Background Shade 2</span>
            <input type="color" id="customBg2Picker" oninput="updateCustomTheme()" value="#1a1a24" style="width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer; background: transparent;">
        </div>
        <div class="toggle-row" style="padding: 0; border: none;">
            <span class="toggle-label" style="font-size: 15px;">Accent Color</span>
            <input type="color" id="customAccentPicker" oninput="updateCustomTheme()" value="#007AFF" style="width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer; background: transparent;">
        </div>
    </div>

    <div class="toggle-row">
        <span class="toggle-label">Default Page</span>
        <select id="startPageSelect" class="setting-select" onchange="updateSetting('startPage', this.value)">
            <option value="home">Home</option>
            <option value="ai-rea">ai-REA</option>
            <option value="songs">Songs</option>
            <option value="videos">Videos</option>
            <option value="games">Games</option>
            <option value="books">Books</option>
            <option value="community">Community</option>
            <option value="settings">Settings</option>
        </select>
    </div>
    <div class="toggle-row">
      <span class="toggle-label">Light Mode</span>
      <input type="checkbox" id="lightToggle" onchange="updateSetting('lightMode', this.checked)">
    </div>
    <div class="toggle-row">
      <span class="toggle-label">iPad/PC Mode (Wide)</span>
      <input type="checkbox" id="ipadToggle" onchange="updateSetting('ipadMode', this.checked);">
    </div>
    <div class="toggle-row">
      <div style="display:flex; flex-direction:column;">
        <span class="toggle-label">Wix Site Width</span>
        <small style="opacity:0.6; font-weight: 500;" id="widthLabel">375px (Desktop)</small>
      </div>
      <input type="range" id="wixWidthSlider" min="320" max="2560" step="20" value="375" oninput="updateSetting('wixWidth', this.value)">
    </div>
    <div class="toggle-row">
      <span class="toggle-label">Page Zoom</span>
      <input type="range" id="uiScaleSlider" min="0.5" max="1.5" step="0.05" value="0.95" oninput="updateSetting('uiScale', this.value)">
    </div>
    
    <div class="toggle-row">
      <span class="toggle-label">Remove ai-REA Tab</span>
      <input type="checkbox" id="removeAireaToggle" onchange="updateSetting('removeAirea', this.checked)">
    </div>

    <div style="height: 1px; background: var(--liquid-glass-border); margin: 30px 0 20px 0;"></div>
    <div style="margin-bottom: 16px; color: var(--accent); font-weight: 800; font-size: 14px; text-transform: uppercase; letter-spacing: 1.5px;">Battery & Performance</div>

    <div class="toggle-row" style="background: rgba(255,45,85,0.05); padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px solid rgba(255,45,85,0.2);">
      <div style="display:flex; flex-direction:column; gap: 6px;">
        <span style="font-size: 17px; font-weight:800; color: #FF2D55;">Ultra Battery Saver</span>
        <small style="opacity:0.9; color: #FF2D55; font-size: 13px; font-weight: 500;">Enables all performance modes, disables box-shadows & extra animations</small>
      </div>
      <input type="checkbox" id="ultraSaverToggle" onchange="toggleUltraSaver(this.checked)" style="accent-color: #FF2D55; width: 24px; height: 24px;">
    </div>

    <div class="toggle-row">
      <span class="toggle-label">Remove Background</span>
      <input type="checkbox" id="noBgToggle" onchange="updateSetting('noBg', this.checked)">
    </div>
    <div class="toggle-row">
      <span class="toggle-label">Solid Glass (Performance)</span>
      <input type="checkbox" id="solidGlassToggle" onchange="updateSetting('solidGlass', this.checked)">
    </div>
    <div class="toggle-row">
      <span class="toggle-label">Half App FPS (Background)</span>
      <input type="checkbox" id="batteryToggle" onchange="updateSetting('batterySaver', this.checked)">
    </div>
  </div>
</section>

</div> 

<div id="customAlert" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(15px); -webkit-backdrop-filter:blur(15px); display:none; align-items:center; justify-content:center; z-index:99999; transition: opacity 0.3s;">
  <div class="glass-card" style="max-width:340px; text-align:center; padding: 30px;">
    <h2 id="alertTitle" style="color:var(--accent); margin-top:0; font-weight: 800;"></h2>
    <p id="alertMsg" style="font-size: 15px; line-height: 1.6;"></p>
    <button class="btn-ios" style="margin-bottom:0; padding:16px; margin-top: 20px;" onclick="closeAlert()">Close</button>
  </div>
</div>

<script>
function vibrate(ms = 15) {
    if(navigator.vibrate) navigator.vibrate(ms);
}
document.addEventListener('click', (e) => {
    if(e.target.closest('button, a, input, select, .clickable, .song-item, .game-ui-header')) {
        vibrate(15);
    }
});

function triggerDynamicTheming(colorHex) {
    if(appSettings.theme !== 'dynamic') return; 
    document.documentElement.style.setProperty('--accent', colorHex);
    let r = parseInt(colorHex.slice(1, 3), 16), g = parseInt(colorHex.slice(3, 5), 16), b = parseInt(colorHex.slice(5, 7), 16);
    document.documentElement.style.setProperty('--accent-glow', `rgba(${r}, ${g}, ${b}, 0.35)`);
}

function toggleTheaterMode(btn) {
    const card = btn.closest('.glass-card');
    const isTheater = document.body.classList.toggle('theater-mode');
    if(isTheater) {
        card.classList.add('theater-focus');
        btn.innerText = "Exit Theater Mode";
    } else {
        card.classList.remove('theater-focus');
        btn.innerText = "Enter Theater Mode";
    }
}

const canvas = document.getElementById('glassCanvas');
const ctx = canvas.getContext('2d');
let points = [];
let animFrameId = null; 
let isTabActive = true;
let bgFrameCount = 0;
document.addEventListener("visibilitychange", () => { isTabActive = !document.hidden; });

const themes = {
  default: { accent: '#007AFF', colors: ['#FF2D55', '#5856D6', '#AF52DE', '#007AFF', '#5AC8FA', '#FF9500'] }, 
  sunset:  { accent: '#FF9500', colors: ['#FF9500', '#FF2D55', '#FFCC00', '#AF52DE', '#FF3B30', '#FF9500'] },
  forest:  { accent: '#34C759', colors: ['#34C759', '#30B0C7', '#007AFF', '#32D74B', '#5AC8FA', '#34C759'] },
  ocean:   { accent: '#5856D6', colors: ['#5856D6', '#007AFF', '#30B0C7', '#5AC8FA', '#AF52DE', '#5856D6'] },
  midnight:{ accent: '#AF52DE', colors: ['#AF52DE', '#5856D6', '#FF2D55', '#007AFF', '#30B0C7', '#AF52DE'] }
};

let appSettings = {
  lightMode: true,
  ipadMode: false,
  noBg: false,
  solidGlass: false,
  batterySaver: false,
  ultraSaver: false,
  removeAirea: false, 
  wixWidth: 375,
  uiScale: 0.95,
  startPage: 'home',
  theme: 'default',
  customTheme: { bg1: '#050507', bg2: '#1a1a24', accent: '#007AFF' }
};

function initCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  points = [];
  
  let palette;
  if (appSettings.theme === 'custom') {
      const ct = appSettings.customTheme || { bg1: '#050507', bg2: '#1a1a24', accent: '#007AFF' };
      palette = [ct.accent, ct.bg1, ct.bg2, ct.accent, '#ffffff', ct.bg1];
  } else {
      const themeKey = appSettings.theme || 'default';
      palette = themes[themeKey] ? themes[themeKey].colors : themes.default.colors;
  }
  
  for(let i=0; i<6; i++) {
    points.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 1.5,
      vy: (Math.random() - 0.5) * 1.5,
      r: Math.random() * 400 + 200, 
      color: palette[i % palette.length]
    });
  }
}

function loop() {
  if (appSettings.noBg || appSettings.ultraSaver) {
    animFrameId = null;
    return;
  }
  
  bgFrameCount++;

  if (appSettings.batterySaver && bgFrameCount % 2 !== 0) {
      animFrameId = requestAnimationFrame(loop);
      return;
  }
  
  ctx.clearRect(0,0,canvas.width, canvas.height);
  points.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    if(p.x < -p.r || p.x > canvas.width + p.r) p.vx *= -1;
    if(p.y < -p.r || p.y > canvas.height + p.r) p.vy *= -1;
    let g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
    g.addColorStop(0, p.color);
    g.addColorStop(1, 'transparent');
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
  });
  
  animFrameId = requestAnimationFrame(loop);
}

function updateSetting(key, val) {
  appSettings[key] = val;
  localStorage.setItem('aREASettings', JSON.stringify(appSettings));
  applySettings();
}

function updateThemeSelection(val) {
    updateSetting('theme', val);
    const customSettings = document.getElementById('customThemeSettings');
    if (val === 'custom') {
        customSettings.style.display = 'flex';
    } else {
        customSettings.style.display = 'none';
    }
    applySettings();
    initCanvas();
}

function updateCustomTheme() {
    appSettings.customTheme = {
        bg1: document.getElementById('customBg1Picker').value,
        bg2: document.getElementById('customBg2Picker').value,
        accent: document.getElementById('customAccentPicker').value
    };
    localStorage.setItem('aREASettings', JSON.stringify(appSettings));
    applySettings();
    initCanvas();
}

function toggleUltraSaver(isOn) {
  updateSetting('ultraSaver', isOn);
  if (isOn) {
    updateSetting('noBg', true);
    updateSetting('solidGlass', true);
    updateSetting('batterySaver', true); 
  }
}

let lastWixWidth = null;
let lastIpadMode = null;
let lastContainerWidth = null;

function applySettings() {
  if (!appSettings) return;
  
  if (appSettings.theme === 'custom') {
      const ct = appSettings.customTheme || { bg1: '#050507', bg2: '#1a1a24', accent: '#007AFF' };
      document.documentElement.style.setProperty('--accent', ct.accent);
      
      let hex = ct.accent;
      let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
      document.documentElement.style.setProperty('--accent-glow', `rgba(${r}, ${g}, ${b}, 0.35)`);
      
      // Apply the user-selected dual background shades safely over body background
      document.body.style.background = `linear-gradient(135deg, ${ct.bg1}, ${ct.bg2})`;
      document.body.style.backgroundAttachment = 'fixed';

      document.getElementById('customBg1Picker').value = ct.bg1;
      document.getElementById('customBg2Picker').value = ct.bg2;
      document.getElementById('customAccentPicker').value = ct.accent;
      document.getElementById('customThemeSettings').style.display = 'flex';
  } else {
      // Clear custom background so body classes (light/dark) take effect natively
      document.body.style.background = '';
      document.body.style.backgroundAttachment = '';
      document.getElementById('customThemeSettings').style.display = 'none';

      const themeKey = appSettings.theme || 'default';
      const themeObj = themes[themeKey] || themes.default;
      document.documentElement.style.setProperty('--accent', themeObj.accent);
      
      let hex = themeObj.accent;
      let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
      document.documentElement.style.setProperty('--accent-glow', `rgba(${r}, ${g}, ${b}, 0.35)`);
  }
  
  document.getElementById('themeSelect').value = appSettings.theme;

  document.body.classList.toggle('light', appSettings.lightMode);
  document.getElementById('lightToggle').checked = appSettings.lightMode;
  
  document.body.classList.toggle('ipad-mode', appSettings.ipadMode);
  document.getElementById('ipadToggle').checked = appSettings.ipadMode;
  
  document.body.classList.toggle('no-bg', appSettings.noBg);
  document.getElementById('noBgToggle').checked = appSettings.noBg;

  document.body.classList.toggle('solid-glass', appSettings.solidGlass);
  document.getElementById('solidGlassToggle').checked = appSettings.solidGlass;

  document.getElementById('batteryToggle').checked = appSettings.batterySaver;

  document.body.classList.toggle('ultra-saver', appSettings.ultraSaver);
  document.getElementById('ultraSaverToggle').checked = appSettings.ultraSaver;
  
  document.getElementById('removeAireaToggle').checked = appSettings.removeAirea;
  
  const aireaNavBtn = document.querySelector('.airea-nav-btn');
  if (appSettings.removeAirea) {
      if (aireaNavBtn) aireaNavBtn.style.display = 'none';
      if(document.getElementById('ai-rea').classList.contains('active')) showTab('home', document.querySelectorAll('.nav-item')[0]);
  } else {
      if (aireaNavBtn) aireaNavBtn.style.display = 'flex';
  }
  
  if (!appSettings.noBg && !appSettings.ultraSaver && !animFrameId) {
    loop();
  }
  
  if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
    document.documentElement.style.setProperty('--ui-zoom', appSettings.uiScale);
  }
  
  if(appSettings.startPage) {
    const sel = document.getElementById('startPageSelect');
    if(sel) sel.value = appSettings.startPage;
  }

  const frame = document.getElementById('wixFrame');
  const wrapper = document.getElementById('wixWrapper');
  const label = document.getElementById('widthLabel');
  
  if (frame && wrapper) {
    const containerWidth = wrapper.offsetWidth;
    if (containerWidth > 0) {
        const targetWidth = parseInt(appSettings.wixWidth);
        
        if (lastWixWidth !== targetWidth || lastIpadMode !== appSettings.ipadMode || lastContainerWidth !== containerWidth) {
            const scaleFactor = containerWidth / targetWidth;
            frame.style.width = targetWidth + "px";
            frame.style.height = (100 / scaleFactor) + "%"; 
            frame.style.transform = `scale(${scaleFactor})`;
            label.innerText = `${targetWidth}px ${appSettings.ipadMode ? '(Desktop)' : '(Mobile)'}`;
            
            lastWixWidth = targetWidth;
            lastIpadMode = appSettings.ipadMode;
            lastContainerWidth = containerWidth;
        }
    }
  }
  document.getElementById('wixWidthSlider').value = appSettings.wixWidth;
  updatePillPosition();
}

function showTab(id, btn) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  const target = document.getElementById(id);
  if(target) target.classList.add('active');
  
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  updatePillPosition(btn);
  window.scrollTo({top: 0, behavior: 'smooth'});

  if(id === 'home') applySettings();
}

function updatePillPosition(btn = document.querySelector('.nav-item.active')) {
  if (!btn) return;
  const pill = document.getElementById('selectionPill');
  
  // FIX: Because the pill is inside the flex scrolling container, offsetLeft acts natively
  // without needing to negate scrollLeft. This keeps it locked into the button accurately.
  pill.style.transform = `translate(${btn.offsetLeft}px, ${btn.offsetTop}px)`;
  pill.style.width = `${btn.offsetWidth}px`;
  pill.style.height = `${btn.offsetHeight}px`;
}

// Observe sidebar navigation layout changes natively during transitions so the active indicator pill transitions perfectly.
const navResizeObserver = new ResizeObserver(() => {
    updatePillPosition();
});

window.addEventListener('resize', () => { 
    updatePillPosition(); 
    initCanvas(); 
    applySettings(); 
});
document.querySelector('.nav-container').addEventListener('scroll', () => updatePillPosition());

let currentAudio = null;
const miniPlayer = document.getElementById('miniPlayer');
const mpTitle = document.getElementById('mpTitle');
const mpPlayIcon = document.getElementById('mpPlayIcon');
const playPath = "M8 5v14l11-7z";
const pausePath = "M6 19h4V5H6v14zm8-14v14h4V5h-4z";

document.addEventListener('play', function(e){
    if(e.target.tagName !== 'AUDIO') return;
    document.querySelectorAll('audio').forEach(audio => {
        if(audio !== e.target) { audio.pause(); audio.currentTime = 0; }
    });
    currentAudio = e.target;
    miniPlayer.classList.add('show');
    mpPlayIcon.querySelector('path').setAttribute('d', pausePath);
    
    const item = e.target.closest('.song-item');
    document.querySelectorAll('.visualizer').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.song-title').forEach(t => t.classList.remove('playing'));
    if(item) {
        mpTitle.innerText = item.querySelector('.song-title').innerText;
        item.querySelector('.visualizer').classList.add('active');
        item.querySelector('.song-title').classList.add('playing');
    }
}, true);

document.addEventListener('pause', function(e){
    if(e.target === currentAudio) {
        mpPlayIcon.querySelector('path').setAttribute('d', playPath);
        document.querySelectorAll('.visualizer').forEach(v => v.classList.remove('active'));
    }
}, true);

function togglePlay() {
    if(!currentAudio) return;
    currentAudio.paused ? currentAudio.play() : currentAudio.pause();
    vibrate(20);
}

let searchTimeout;
function filterSongs(val) {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    const term = val.toLowerCase().trim();
    const items = document.querySelectorAll('.song-item');
    
    items.forEach(item => {
      const title = item.querySelector('.song-title').innerText.toLowerCase();
      item.style.display = title.includes(term) ? 'flex' : 'none';
    });

    document.querySelectorAll('.glass-card > div[style*="margin-top"]').forEach(section => {
      const hasVisible = Array.from(section.querySelectorAll('.song-item')).some(s => s.style.display === 'flex');
      section.style.display = (hasVisible || term === "") ? 'block' : 'none';
    });
  }, 150);
}

function openAlexModal() {
  document.getElementById('alertTitle').innerText = "Alexandru News";
  
  document.getElementById('alertMsg').innerHTML = `
    Alexandru Bojescu was my best friend and loved creating with Arduino (Microchips that could do cool stuff like his lie detector.) He had some really cool friends like Abu (who sadly had appendicitis), Hamid, Aadil and Me. Though, lately, he moved to a more quiet neighbourhood. Now me, Aqeel, is continuing with his legacy by making coding projects including this app. Goodbye, Alexandru.. I still have his contact at least...
    <br><br>
    <div style="border-radius: 16px; overflow: hidden; border: 1px solid var(--liquid-glass-border);">
    <video width="100%" controls playsinline preload="metadata" style="display:block; border-radius: 0;">
      <source src="https://www.dropbox.com/scl/fi/wb2pifryo0xfq2ohht6m7/IMG_2399.mov?rlkey=klp54pc6lbpmdy3qtymqvkg8g&st=3oaxf87p&raw=1" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    </div>
  `; 

  document.getElementById('customAlert').style.display = 'flex';
}

function closeAlert() { document.getElementById('customAlert').style.display = 'none'; }

function loadStoredSettings() {
  const saved = localStorage.getItem('aREASettings');
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      appSettings = { ...appSettings, ...parsed };
      
      // Prevent undefined crashes if custom theme was absent in previously saved configurations
      if (!appSettings.customTheme) {
          appSettings.customTheme = { bg1: '#050507', bg2: '#1a1a24', accent: '#007AFF' };
      }
    } catch(e) { console.error("Error loading settings", e); }
  }
}

window.onload = () => {
  navResizeObserver.observe(document.querySelector('.nav-container'));
  loadStoredSettings();
  initCanvas();
  loop();
  applySettings();
  
  const pages = ['home', 'ai-rea', 'songs', 'videos', 'games', 'books', 'community', 'settings'];
  const startPage = appSettings.startPage || 'home';
  const startIndex = pages.indexOf(startPage);
  if(startIndex > -1) {
    if(startPage === 'ai-rea' && appSettings.removeAirea) {
      showTab('home', document.querySelectorAll('.nav-item')[0]);
    } else {
      showTab(startPage, document.querySelectorAll('.nav-item')[startIndex]);
    }
  }
};

let audioCtx;
let analyser;
let dataArray;
let sourceNodes = new Map();

function initAudioVisualizer(audioElement) {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 32;
    const bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);
  }

  if (!sourceNodes.has(audioElement)) {
    const source = audioCtx.createMediaElementSource(audioElement);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    sourceNodes.set(audioElement, source);
  }

  let localFrames = 0;
  function updateBars() {
    if (audioElement.paused || appSettings.ultraSaver) return; 
    
    localFrames++;
    if (appSettings.batterySaver && localFrames % 2 !== 0) {
        requestAnimationFrame(updateBars);
        return;
    }

    analyser.getByteFrequencyData(dataArray);
    
    const container = audioElement.closest('.song-item');
    const bars = container.querySelectorAll('.bar');
    
    bars.forEach((bar, i) => {
      const val = dataArray[i] / 255;
      const height = 4 + (val * 16);
      bar.style.height = height + 'px';
    });
    
    requestAnimationFrame(updateBars);
  }
  
  if (audioCtx.state === 'suspended') audioCtx.resume();
  updateBars();
}

document.querySelectorAll('audio').forEach(audio => {
  audio.addEventListener('play', () => initAudioVisualizer(audio));
});
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDNcrCDEby6pkvdwi0_-WPqS8L21RhrOX8",
      authDomain: "a-rea-220da.firebaseapp.com",
      projectId: "a-rea-220da",
      storageBucket: "a-rea-220da.firebasestorage.app",
      messagingSenderId: "1046969467026",
      appId: "1:1046969467026:web:f67fffc6312c2996cb664b",
      measurementId: "G-LE90K55Y65"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = 'a-rea-web-comments';

    const commentsContainer = document.getElementById('commentsContainer');
    const usernameInput = document.getElementById('username');
    const messageInput = document.getElementById('message');
    const postBtn = document.getElementById('postBtn');

    let currentUser = null;

    const initAuth = async () => {
        try {
            await signInAnonymously(auth);
        } catch (error) {
            console.error("Auth failed:", error);
            commentsContainer.innerHTML = `<div style="text-align: center; color: #ff6b6b;">Auth Error: Enable Anonymous Login in Firebase Console.</div>`;
        }
    };

    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if (user) {
            loadComments();
        }
    });

    function loadComments() {
        const commentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'comments');
        
        onSnapshot(commentsRef, (snapshot) => {
            const comments = [];
            snapshot.forEach(doc => {
                comments.push({ id: doc.id, ...doc.data() });
            });
            comments.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
            renderComments(comments);
        }, (err) => {
            console.error("Listen failed:", err);
            commentsContainer.innerHTML = `<div style="text-align: center; color: #ff6b6b;">Failed to load. Check Database Rules.</div>`;
        });
    }

    function renderComments(comments) {
        if (comments.length === 0) {
            commentsContainer.innerHTML = `<div style="text-align: center; padding: 40px; color: var(--text-mute); font-style: italic;">No comments yet. Be the first!</div>`;
            return;
        }

        commentsContainer.innerHTML = comments.map(c => `
            <div class="glass-card" style="padding: 24px; margin-bottom: 0;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                    <span style="font-weight: 800; color: var(--accent); font-size: 15px;">@${escapeHtml(c.username || 'Anonymous')}</span>
                    <span style="font-size: 12px; font-weight: 700; color: var(--text-mute); text-transform: uppercase;">
                        ${c.timestamp ? new Date(c.timestamp.seconds * 1000).toLocaleDateString() : 'Just now'}
                    </span>
                </div>
                <p style="color: var(--text-main); word-break: break-word; line-height: 1.6; margin: 0; font-size: 16px;">${escapeHtml(c.message || '')}</p>
            </div>
        `).join('');
    }

    postBtn.addEventListener('click', async () => {
        const username = usernameInput.value.trim();
        const message = messageInput.value.trim();

        if (!username || !message || !currentUser) return;

        postBtn.disabled = true;
        const originalText = postBtn.innerText;
        postBtn.innerText = "Posting...";

        try {
            const commentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'comments');
            await addDoc(commentsRef, {
                username: username,
                message: message,
                timestamp: serverTimestamp(),
                userId: currentUser.uid
            });
            messageInput.value = '';
        } catch (error) {
            console.error("Post failed:", error);
            alert("Could not post. Check if Database Rules allow writes.");
        } finally {
            postBtn.disabled = false;
            postBtn.innerText = originalText;
        }
    });

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    initAuth();
</script>
</body>
</html>
