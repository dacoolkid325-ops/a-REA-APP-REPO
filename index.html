<!DOCTYPE html>
<html lang="en" style="--ui-zoom: 0.95;"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>a-REA</title>
<!-- Apple Touch Icons Preserved -->
<link rel="apple-touch-icon" href="icons/apple-touch-icon-iphone-60x60.png">
<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-touch-icon-ipad-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-touch-icon-iphone-retina-120x120.png"> 
<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-touch-icon-ipad-retina-152x152.png">

<style>
:root {
  --bg-dark: #000000;
  --text-main: #ffffff;
  --text-mute: rgba(255, 255, 255, 0.5);
  --accent: #007AFF; /* Default Accent */
  
  /* Glass Specs */
  --liquid-glass-bg: rgba(255, 255, 255, 0.12);
  --liquid-glass-border: rgba(255, 255, 255, 0.2);
  --liquid-glass-shine: rgba(255, 255, 255, 0.4);
  --ui-zoom: 0.95;
  
  /* Pill & Nav Colors */
  --nav-bg: rgba(20, 20, 20, 0.6);
  --pill-bg: rgba(255, 255, 255, 0.15);
  --pill-border: rgba(255, 255, 255, 0.2);
  --player-bg: rgba(20, 20, 20, 0.85);
}

body {
  margin: 0;
  background-color: var(--bg-dark);
  color: var(--text-main);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
  overflow-x: hidden;
  min-height: 100vh;
  transform: scale(var(--ui-zoom));
  transform-origin: top center;
  width: calc(100% / var(--ui-zoom));
  padding-bottom: 160px; /* Padding for nav + player */
  transition: background-color 0.3s ease, color 0.3s ease;
}

body.light {
  --bg-dark: #f2f2f7;
  --text-main: #000000;
  --text-mute: rgba(0, 0, 0, 0.5);
  --liquid-glass-bg: rgba(255, 255, 255, 0.7);
  --liquid-glass-border: rgba(0, 0, 0, 0.05);
  --liquid-glass-shine: rgba(255, 255, 255, 1);
  --nav-bg: rgba(240, 240, 245, 0.8);
  --pill-bg: #ffffff;
  --pill-border: rgba(0, 0, 0, 0.1);
  --player-bg: rgba(255, 255, 255, 0.85);
}

body.no-bg #glassCanvas { display: none !important; }

/* iPad/PC Mode Layout */
body.ipad-mode section {
  max-width: 98% !important;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

#glassCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  filter: blur(60px) contrast(1.2);
  opacity: 0.8;
  transition: opacity 0.5s;
}

section {
  display: none;
  padding: 20px;
  max-width: 600px;
  margin: 0 auto;
  animation: pageEnter 0.4s cubic-bezier(0.2, 1, 0.3, 1);
}
section.active { display: block; }

@keyframes pageEnter {
  from { opacity: 0; transform: scale(0.98) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.glass-card {
  background: var(--liquid-glass-bg);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  border: 1px solid var(--liquid-glass-border);
  border-top: 1px solid var(--liquid-glass-shine);
  border-radius: 28px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  cursor: default;
  transition: transform 0.2s ease, max-width 0.3s ease;
}

.glass-card.clickable:active { transform: scale(0.98); }

.search-wrapper {
  position: relative;
  margin-bottom: 25px;
  width: 100%;
}

.search-input {
  width: 100%;
  padding: 16px 20px 16px 45px;
  border-radius: 20px;
  font-size: 17px;
  color: var(--text-main);
  outline: none;
  transition: all 0.3s ease;
  
  /* TRUE LIQUID GLASS */
  background: rgba(255, 255, 255, 0.2) !important;
  backdrop-filter: blur(20px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-top: 1px solid rgba(255, 255, 255, 0.4) !important;
}

.search-icon-inside {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  color: var(--text-main);
  opacity: 0.6; /* Blends it into the glass */
  z-index: 2;
  pointer-events: none;
}

/* STOPS SQUISHING AND BLUE LINES */
/* STABLE LAYOUT - PREVENTS SQUISHING */
.song-item {
  display: flex; /* Changed from block to flex for stability */
  flex-direction: column;
  padding: 12px 0;
  border-bottom: 1px solid var(--liquid-glass-border);
  min-height: 110px; /* Ensures space is reserved */
}

.visualizer {
  display: flex;
  align-items: flex-end;
  height: 20px; /* Fixed height for the bars to live in */
  gap: 3px;
  width: 30px;
}

.bar {
  width: 4px;
  height: 4px; /* Initial height */
  background: var(--accent);
  border-radius: 2px;
  transition: height 0.1s ease; /* Smooth movement */
  flex-shrink: 0;
}



.visualizer.active { opacity: 1; }
.bar {
  width: 3px;
  background: var(--accent);
  border-radius: 1px;
  animation: bounce 0s infinite alternate;
}
.visualizer.active .bar { animation-duration: 0.4s; }
.bar:nth-child(1) { height: 6px; animation-delay: 0.1s; }
.bar:nth-child(2) { height: 10px; animation-delay: 0.3s; }
.bar:nth-child(3) { height: 8px; animation-delay: 0.0s; }
.bar:nth-child(4) { height: 5px; animation-delay: 0.2s; }

@keyframes bounce {
  from { height: 4px; }
  to { height: 12px; }
}

/* --- WIX SCALE CONTAINER --- */
.iframe-wrapper {
  height: 80vh; 
  padding: 0; 
  overflow: hidden; 
  border-radius: 24px;
  position: relative;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}

.wix-iframe {
  border: none;
  position: absolute;
  top: 0;
  left: 0;
  transform-origin: top left;
  transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1), width 0.3s ease;
}

/* --- NAV BAR --- */
.nav-container {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: fit-content;
  display: flex;
  align-items: center;
  padding: 8px;
  z-index: 1000;
  background: var(--nav-bg);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  border-radius: 35px;
  border: 1px solid var(--liquid-glass-border);
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
}

.nav-item {
  position: relative;
  background: none;
  border: none;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: color 0.3s;
  color: var(--text-mute);
  z-index: 2;
}

.nav-selection-pill {
  position: absolute;
  height: 56px;
  width: 56px;
  background: var(--pill-bg);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid var(--pill-border);
  border-radius: 28px;
  z-index: 1;
  transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
  pointer-events: none;
}

.nav-item.active { color: var(--text-main); }
svg { width: 28px; height: 28px; fill: currentColor; }

/* --- UI ELEMENTS --- */
.song-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.song-title { font-weight: 600; font-size: 15px; display: block; transition: color 0.3s;}
.song-title.playing { color: var(--accent); }

audio { width: 100%; height: 38px; border-radius: 20px; margin-bottom: 16px; }
video { width: 100%; border-radius: 20px; border: none; background: #000;}

.btn-ios {
  display: block; width: 100%; padding: 18px; background: var(--accent);
  color: #fff; text-decoration: none; border-radius: 20px; text-align: center;
  font-weight: 600; font-size: 17px; margin-bottom: 20px;
}

.toggle-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 16px 0; border-bottom: 1px solid var(--liquid-glass-border);
}
.toggle-row:last-child { border-bottom: none; }

input[type="range"] {
  width: 140px;
  accent-color: var(--accent);
}

.setting-select {
  background: var(--pill-bg);
  color: var(--text-main);
  border: 1px solid var(--liquid-glass-border);
  border-radius: 12px;
  padding: 8px 12px;
  font-size: 15px;
  outline: none;
  backdrop-filter: blur(10px);
  -webkit-appearance: none;
}
.setting-select option {
  background: var(--bg-dark);
  color: var(--text-main);
}

/* --- MINI PLAYER --- */
#miniPlayer {
  position: fixed;
  bottom: 120px;
  left: 50%;
  transform: translateX(-50%) scale(0.9);
  width: 90%;
  max-width: 400px;
  background: var(--player-bg);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--liquid-glass-border);
  border-radius: 22px;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
  z-index: 900;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#miniPlayer.show {
  bottom: 110px;
  opacity: 1;
  pointer-events: auto;
  transform: translateX(-50%) scale(1);
}

.mp-info { display: flex; flex-direction: column; overflow: hidden; }
.mp-title {
  font-weight: 600; font-size: 14px; white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis; color: var(--text-main);
}
.mp-status { font-size: 11px; color: var(--accent); font-weight: 500; margin-top: 2px; }

.mp-controls { display: flex; gap: 15px; align-items: center; }
.mp-btn {
  background: none; border: none; padding: 0; cursor: pointer;
  color: var(--text-main); display: flex; align-items: center; justify-content: center;
}

/* GAMES OVERRIDES */
.ultra-wide-section {
  max-width: 98% !important;
  width: 98% !important;
  padding: 10px !important;
  margin: 0 auto;
}
.section-title { font-size: 42px; font-weight: 800; margin-bottom: 20px; text-align: center; color: var(--text-main); }
.btn-ios-large {
  display: block; width: 100%; max-width: 600px; margin: 0 auto 40px auto;
  padding: 24px; background: #007AFF; color: white; text-align: center;
  text-decoration: none; border-radius: 24px; font-weight: 700; font-size: 20px;
}
.ultra-grid { display: flex; flex-direction: column; gap: 40px; width: 100%; }
.game-container-giant {
  height: 750px !important; padding: 0 !important; border-radius: 32px !important;
  display: flex; flex-direction: column; overflow: hidden;
  background: var(--liquid-glass-bg); border: 1px solid var(--liquid-glass-border);
  transition: all 0.3s ease;
}
body.ipad-mode .game-container-giant { height: 850px !important; }
.game-ui-header {
  padding: 15px 25px; background: rgba(0,0,0,0.3); display: flex;
  align-items: center; gap: 15px;
}
.status-dot { width: 10px; height: 10px; background: #34C759; border-radius: 50%; box-shadow: 0 0 8px #34C759; }
.game-label { font-weight: 800; letter-spacing: 1px; flex-grow: 1; color: #fff; }
.expand-trigger {
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: white; padding: 10px; border-radius: 12px; cursor: pointer;
}
.game-viewport { flex-grow: 1; background: #000; position: relative; overflow: hidden; }
.game-iframe {
  border: none; position: absolute; top: 0; left: 0;
  transform-origin: top left; width: 100%; height: 100%;
}
.game-container-giant.is-active-fs {
  position: fixed !important; top: 0 !important; left: 0 !important;
  width: 100vw !important; height: 100vh !important;
  z-index: 999999 !important; border-radius: 0 !important; margin: 0 !important;
}
body.ipad-mode .ultra-grid { display: grid; grid-template-columns: 1fr 1fr; }
.spinner {
  width: 30px;
  height: 30px;
  border: 3px solid rgba(255,255,255,0.1);
  border-top: 3px solid var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite
</style>
</head>
<body class="light ipad-mode">

<canvas id="glassCanvas" width="1440" height="865"></canvas>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div class="mp-info">
    <span class="mp-title" id="mpTitle">Not Playing</span>
    <span class="mp-status">Now Playing</span>
  </div>
  <div class="mp-controls">
    <button class="mp-btn" onclick="togglePlay()">
      <svg id="mpPlayIcon" viewBox="0 0 24 24" width="28" height="28"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    </button>
  </div>
</div>

<section id="home" class="active">
  <div class="glass-card clickable" style="border-left: 4px solid var(--accent); position: relative;" onclick="openAlexModal()">
    <strong style="color:var(--accent)">Alexandru News</strong><br>
    <span style="font-size: 14px; opacity: 0.8;">Click to find out about Alexandru and why I'm commiting to his legacy!.</span>
    <div style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); opacity: 0.5;">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
    </div>
  </div>

  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 0 10px;">
    <button onclick="reloadWixFrame()" style="background: var(--pill-bg); border: 1px solid var(--pill-border); color: var(--text-main); padding: 6px 12px; border-radius: 12px; font-size: 12px; cursor: pointer; backdrop-filter: blur(10px);">
      Reload Site
    </button>
  </div>

  <div class="glass-card iframe-wrapper" id="wixWrapper" style="padding: 0; background: #000; overflow: hidden; height: 70vh;">
    <div id="wixLoader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 5; display: none;">
       <div class="spinner"></div>
    </div>
    
    <iframe 
      id="wixFrame" 
      class="wix-iframe" 
      src="https://aqeelchy02.wixsite.com/a-rea" 
      onload="hideWixLoader()"
      style="width: 375px; border: none; transform-origin: top left;">
    </iframe>
  </div>
</section>


<section id="songs">
  <h1>Musical Story</h1>

  <!-- SEARCH BAR WITH WORKING FILLED ICON -->
  <div class="search-wrapper">
    <svg class="search-icon-inside" viewBox="0 0 24 24">
      <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    </svg>
    <input type="text" class="search-input" placeholder="Search Songs..." oninput="filterSongs(this.value)">
  </div>

  <div class="glass-card">
    <div class="song-item">
      <div class="song-header">
        <span class="song-title">01 – a-REA (Original)</span>
        <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      </div>
      <audio controls="" src="audio/01 - Aqeel Ahmed Choudhury - a-REA.mp3"></audio>
    </div>

    <div class="song-item">
      <div class="song-header">
        <span class="song-title">02 – L-INE GRAPHS!</span>
        <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      </div>
      <audio controls="" src="audio/02 - Aqeel Ahmed Choudhury - L-INE GRAPHS!.mp3"></audio>
    </div>

    <div class="song-item">
      <div class="song-header">
        <span class="song-title">03 – T-ABLES!!</span>
        <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      </div>
      <audio controls="" src="audio/03 - Aqeel Ahmed Choudhury - T-ABES!!.mp3"></audio>
    </div>

    <div class="song-item">
      <div class="song-header">
        <span class="song-title">04 – T-IMETABLES!!</span>
        <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      </div>
      <audio controls="" src="audio/04 - Aqeel Ahmed Choudhury - T-IMETABLES!!!.mp3"></audio>
    </div>

    <div class="song-item">
      <div class="song-header">
        <span class="song-title">05 – A-NGLES!!!!</span>
        <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
      </div>
      <audio controls="" src="audio/05 - Aqeel Ahmed Choudhury - A-NGLES!!!!.mp3"></audio>
    </div>

    <div style="margin-top:20px; padding-top:20px; border-top: 1px solid var(--liquid-glass-border);">
      <div class="song-item">
        <div class="song-header">
          <span class="song-title" style="color:var(--accent)">Bonus – a-REA Revamp</span>
          <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        </div>
        <audio controls="" src="audio/aREAREVAMP.m4a"></audio>
      </div>
      <div class="song-item">
        <div class="song-header">
          <span class="song-title">NEW – MASTER</span>
          <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        </div>
        <audio controls="" src="Music/MASTER.m4a"></audio>
      </div>
      <div class="song-item">
        <div class="song-header">
          <span class="song-title">FAN FAVOURITE – TINY</span>
          <div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        </div>
        <audio controls="" src="audio/Tiny.m4a"></audio>
      </div>
    </div>
  </div>
</section>

<section id="videos">
  <h1>Videos</h1>
  <div class="glass-card">
    <span class="song-title">aq.co direct - a-REA 2.0</span>
    <video controls="" src="https://www.dropbox.com/scl/fi/kvyqipeicp9iw4jwq743f/aq.co-direct-a-REA-2.0-07.05.2025.mp4?rlkey=mt0h8e3x16sltw6jvm1a3lyfg&amp;raw=1"></video>
  </div>
</section>

<section id="games" class="ultra-wide-section">
  <h1 class="section-title">Games</h1>
  <a href="https://www.roblox.com/games/70684065412187/a-REA-HANGOUT" class="btn-ios-large">LAUNCH a-REA HANGOUT</a>
  
  <div class="ultra-grid">
    <div class="glass-card game-container-giant">
      <div class="game-ui-header">
        <div class="status-dot"></div>
        <span class="game-label">MASTER</span>
        <button class="expand-trigger" onclick="handleFullscreen(this)">
          <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2.5" fill="none"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
        </button>
      </div>
      <div class="game-viewport">
        <iframe src="file.html" class="game-iframe" data-virtual-width="1200"></iframe>
      </div>
    </div>

    <div class="glass-card game-container-giant">
      <div class="game-ui-header">
        <div class="status-dot"></div>
        <span class="game-label">TINY DASH</span>
        <button class="expand-trigger" onclick="handleFullscreen(this)">
          <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2.5" fill="none"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
        </button>
      </div>
      <div class="game-viewport">
        <iframe src="tiny.html" class="game-iframe" data-virtual-width="1200"></iframe>
      </div>
    </div>
  </div>
  <script>
    function handleFullscreen(btn) {
      const card = btn.closest('.game-container-giant');
      const isNowFull = card.classList.toggle('is-active-fs');
      if (isNowFull) { document.body.style.overflow = 'hidden'; }
      else { document.body.style.overflow = ''; }
      if (typeof scaleGameIframes === 'function') {
        setTimeout(scaleGameIframes, 10);
        setTimeout(scaleGameIframes, 300);
      }
    }
    setTimeout(() => { if (typeof scaleGameIframes === 'function') scaleGameIframes(); }, 500);
    function reloadWixFrame() {
    const frame = document.getElementById('wixFrame');
    const loader = document.getElementById('wixLoader');
    if (frame) {
        if(loader) loader.style.display = 'block'; // Show spinner
        const currentSrc = frame.src;
        frame.src = ''; 
        setTimeout(() => {
            frame.src = currentSrc;
            applySettings(); // Re-apply the sizing scale immediately
        }, 50);
    }
}

function hideWixLoader() {
    const loader = document.getElementById('wixLoader');
    if(loader) loader.style.display = 'none';
}

  </script>
</section>

<section id="books">
  <h1 style="text-align: center; margin-bottom: 24px;">Library</h1>
  <div class="glass-card" style="padding: 10px; height: 600px; display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px;">
    <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/5fac1c0a65.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: rgba(0,0,0,0.1);"></iframe>
    <a href="https://www.dropbox.com/scl/fi/f2ny0p7u6eai9dtqlu8vn/Trash.pdf?rlkey=z3410okcjoxwysje6dvkgt3im&st=yc0svifc&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
      <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Download Trash
    </a>
  </div>
  <div class="glass-card" style="padding: 10px; height: 600px; display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px;">
    <iframe allowfullscreen="allowfullscreen" allow="clipboard-write" scrolling="no" class="fp-iframe" src="https://heyzine.com/flip-book/5b6763ab02.html" style="border: 0px; width: 100%; flex-grow: 1; border-radius: 18px; background: rgba(0,0,0,0.1);"></iframe>
    <a href="https://www.dropbox.com/scl/fi/jbxyot1tvss95wmy8oqsp/Skellig.pdf?rlkey=zw8p0z9eatsacec76omwdkoko&st=wi7kelpx&raw=1" target="_blank" class="btn-ios" style="margin-bottom: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
      <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"></path></svg> Download Skellig
    </a>
  </div>
</section>

<section id="settings">
  <h1>Settings</h1>
  <div class="glass-card">
    <div class="toggle-row">
        <span style="font-size: 17px; font-weight:500;">Theme / Mood</span>
        <select id="themeSelect" class="setting-select" onchange="updateSetting('theme', this.value)">
            <option value="default">Default (Blue)</option>
            <option value="sunset">Sunset (Orange)</option>
            <option value="forest">Forest (Green)</option>
            <option value="ocean">Ocean (Deep Blue)</option>
            <option value="midnight">Midnight (Purple)</option>
        </select>
    </div>
    <div class="toggle-row">
        <span style="font-size: 17px; font-weight:500;">Default Page</span>
        <select id="startPageSelect" class="setting-select" onchange="updateSetting('startPage', this.value)">
            <option value="home">Home</option>
            <option value="songs">Songs</option>
            <option value="videos">Videos</option>
            <option value="games">Games</option>
            <option value="books">Books</option>
            <option value="settings">Settings</option>
        </select>
    </div>
    <div class="toggle-row">
      <span style="font-size: 17px; font-weight:500;">Light Mode</span>
      <input type="checkbox" id="lightToggle" onchange="updateSetting('lightMode', this.checked)">
    </div>
    <div class="toggle-row">
      <span style="font-size: 17px; font-weight:500;">iPad/PC Mode (Wide)</span>
      <input type="checkbox" id="ipadToggle" onchange="updateSetting('ipadMode', this.checked); reloadWixFrame();">
    </div>
    <div class="toggle-row">
      <span style="font-size: 17px; font-weight:500;">Remove Background</span>
      <input type="checkbox" id="noBgToggle" onchange="updateSetting('noBg', this.checked)">
    </div>
    <div class="toggle-row">
      <div style="display:flex; flex-direction:column;">
        <span style="font-size: 17px; font-weight:500;">Wix Site Width</span>
        <small style="opacity:0.6" id="widthLabel">375px (Desktop)</small>
      </div>
      <!-- ADDED onchange="reloadWixFrame()" to allow refresh after drag -->
      <input type="range" id="wixWidthSlider" min="320" max="2560" step="20" value="375" oninput="updateSetting('wixWidth', this.value)" onchange="reloadWixFrame()">
    </div>
    <div class="toggle-row">
      <span style="font-size: 17px; font-weight:500;">Page Zoom</span>
      <input type="range" id="uiScaleSlider" min="0.5" max="1.5" step="0.05" value="0.95" oninput="updateSetting('uiScale', this.value)">
    </div>
  </div>
</section>

<!-- NAV BAR with CLEAN ICONS -->
<div class="nav-container">
 <div id="selectionPill" class="nav-selection-pill" style="transform: translateX(8px);"></div>
  <button class="nav-item active" onclick="showTab('home', this, 0)"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg></button>
  <button class="nav-item" onclick="showTab('songs', this, 1)"><svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"></path></svg></button>
  <button class="nav-item" onclick="showTab('videos', this, 2)"><svg viewBox="0 0 24 24"><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg></button>
  <button class="nav-item" onclick="showTab('games', this, 3)">
    <svg viewBox="0 0 24 24">
      <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm7 2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-3-3c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path>
    </svg>
  </button>
  <button class="nav-item" onclick="showTab('books', this, 4)"><svg viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path></svg></button>
  <button class="nav-item" onclick="showTab('settings', this, 5)">
    <!-- FIXED SETTINGS ICON -->
    <svg viewBox="0 0 24 24">
      <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
    </svg>
  </button>
</div>

<div id="customAlert" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(10px); display:none; align-items:center; justify-content:center; z-index:9999;">
  <div class="glass-card" style="max-width:300px; text-align:center;">
    <h2 id="alertTitle" style="color:var(--accent); margin-top:0;"></h2>
    <p id="alertMsg"></p>
    <button class="btn-ios" style="margin-bottom:0; padding:12px;" onclick="closeAlert()">Close</button>
  </div>
</div>

<script>
const canvas = document.getElementById('glassCanvas');
const ctx = canvas.getContext('2d');
let points = [];

// THEME PALETTES
const themes = {
  default: { accent: '#007AFF', colors: ['#007AFF', '#5856D6', '#AF52DE', '#FF2D55'] },
  sunset:  { accent: '#FF9500', colors: ['#FF9500', '#FF2D55', '#FFCC00', '#AF52DE'] },
  forest:  { accent: '#34C759', colors: ['#34C759', '#30B0C7', '#007AFF', '#32D74B'] },
  ocean:   { accent: '#5856D6', colors: ['#5856D6', '#007AFF', '#30B0C7', '#5AC8FA'] },
  midnight:{ accent: '#AF52DE', colors: ['#AF52DE', '#5856D6', '#FF2D55', '#007AFF'] }
};

let appSettings = {
  lightMode: true,
  ipadMode: false,
  noBg: false,
  wixWidth: 375,
  uiScale: 0.95,
  startPage: 'home',
  theme: 'default'
};

function initCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  points = [];
  
  // Use current theme colors
  const themeKey = appSettings.theme || 'default';
  const palette = themes[themeKey] ? themes[themeKey].colors : themes.default.colors;
  
  for(let i=0; i<6; i++) {
    points.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 1.5,
      vy: (Math.random() - 0.5) * 1.5,
      r: Math.random() * 300 + 200,
      color: palette[i % palette.length]
    });
  }
}

function loop() {
  if (!appSettings.noBg) {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    points.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      if(p.x < -p.r || p.x > canvas.width + p.r) p.vx *= -1;
      if(p.y < -p.r || p.y > canvas.height + p.r) p.vy *= -1;
      let g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
      g.addColorStop(0, p.color);
      g.addColorStop(1, 'transparent');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    });
  }
  requestAnimationFrame(loop);
}

function updateSetting(key, val) {
  appSettings[key] = val;
  localStorage.setItem('aREASettings', JSON.stringify(appSettings));
  applySettings();
  
  // Re-init canvas if theme changes
  if(key === 'theme') {
    initCanvas();
  }
}

// Function to force Wix iframe reload for layout changes
function reloadWixFrame() {
    const frame = document.getElementById('wixFrame');
    if (frame) {
        const currentSrc = frame.src;
        // Temporarily clear src to force a refresh on re-assignment
        frame.src = '';
        setTimeout(() => {
            frame.src = currentSrc;
        }, 50);
    }
}

function applySettings() {
  if (!appSettings) return;
  
  // Theme Application
  const themeKey = appSettings.theme || 'default';
  const themeObj = themes[themeKey] || themes.default;
  document.documentElement.style.setProperty('--accent', themeObj.accent);
  document.getElementById('themeSelect').value = themeKey;

  document.body.classList.toggle('light', appSettings.lightMode);
  document.getElementById('lightToggle').checked = appSettings.lightMode;
  
  document.body.classList.toggle('ipad-mode', appSettings.ipadMode);
  document.getElementById('ipadToggle').checked = appSettings.ipadMode;
  
  document.body.classList.toggle('no-bg', appSettings.noBg);
  document.getElementById('noBgToggle').checked = appSettings.noBg;
  
  // Only apply zoom if we aren't currently typing in the search bar
if (document.activeElement.tagName !== 'INPUT') {
    document.documentElement.style.setProperty('--ui-zoom', appSettings.uiScale);
}
  
  if(appSettings.startPage) {
    const sel = document.getElementById('startPageSelect');
    if(sel) sel.value = appSettings.startPage;
  }

  const frame = document.getElementById('wixFrame');
  const wrapper = document.getElementById('wixWrapper');
  const label = document.getElementById('widthLabel');
  
  if (frame && wrapper) {
    const containerWidth = wrapper.offsetWidth;
    const targetWidth = parseInt(appSettings.wixWidth);
    const scaleFactor = containerWidth / targetWidth;
    frame.style.width = targetWidth + "px";
    frame.style.height = (100 / scaleFactor) + "%"; 
    frame.style.transform = `scale(${scaleFactor})`;
    label.innerText = `${targetWidth}px ${appSettings.ipadMode ? '(Desktop)' : '(Mobile)'}`;
  }
  document.getElementById('wixWidthSlider').value = appSettings.wixWidth;
}

function showTab(id, btn, index) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  const target = document.getElementById(id);
  if(target) target.classList.add('active');
  
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  const pill = document.getElementById('selectionPill');
  pill.style.transform = `translateX(${index * 64 + 8}px)`;
  window.scrollTo({top: 0, behavior: 'smooth'});
}

/* MEDIA LOGIC */
let currentAudio = null;
const miniPlayer = document.getElementById('miniPlayer');
const mpTitle = document.getElementById('mpTitle');
const mpPlayIcon = document.getElementById('mpPlayIcon');
const playPath = "M8 5v14l11-7z";
const pausePath = "M6 19h4V5H6v14zm8-14v14h4V5h-4z";

document.addEventListener('play', function(e){
    if(e.target.tagName !== 'AUDIO') return;
    document.querySelectorAll('audio').forEach(audio => {
        if(audio !== e.target) { audio.pause(); audio.currentTime = 0; }
    });
    currentAudio = e.target;
    miniPlayer.classList.add('show');
    mpPlayIcon.querySelector('path').setAttribute('d', pausePath);
    
    // Update visuals
    const item = e.target.closest('.song-item');
    document.querySelectorAll('.visualizer').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.song-title').forEach(t => t.classList.remove('playing'));
    if(item) {
        mpTitle.innerText = item.querySelector('.song-title').innerText;
        item.querySelector('.visualizer').classList.add('active');
        item.querySelector('.song-title').classList.add('playing');
    }
}, true);

document.addEventListener('pause', function(e){
    if(e.target === currentAudio) {
        mpPlayIcon.querySelector('path').setAttribute('d', playPath);
        document.querySelectorAll('.visualizer').forEach(v => v.classList.remove('active'));
    }
}, true);

function togglePlay() {
    if(!currentAudio) return;
    currentAudio.paused ? currentAudio.play() : currentAudio.pause();
}

function filterSongs(val) {
  const term = val.toLowerCase().trim();
  const items = document.querySelectorAll('.song-item');
  
  items.forEach(item => {
    const title = item.querySelector('.song-title').innerText.toLowerCase();
    // Use 'flex' instead of 'block' to maintain the internal layout
    item.style.display = title.includes(term) ? 'flex' : 'none';
  });

  // Handle section headers (Bonus/New)
  document.querySelectorAll('.glass-card > div[style*="margin-top"]').forEach(section => {
    const hasVisible = Array.from(section.querySelectorAll('.song-item')).some(s => s.style.display === 'flex');
    section.style.display = (hasVisible || term === "") ? 'block' : 'none';
  });
}


function openAlexModal() {
  document.getElementById('alertTitle').innerText = "Alexandru News";
  document.getElementById('alertMsg').innerText = "Alexandru Bojescu was my best friend and loved creating with Arduino (Microchips that could do cool stuff like his lie detector.) Now me, Aqeel, is continuing with his legacy by making coding projects including this app. Goodbye, Alexandru..";
  document.getElementById('customAlert').style.display = 'flex';
}
function closeAlert() { document.getElementById('customAlert').style.display = 'none'; }

function loadStoredSettings() {
  const saved = localStorage.getItem('aREASettings');
  if (saved) {
    try {
      appSettings = JSON.parse(saved);
      if(!appSettings.startPage) appSettings.startPage = 'home';
      if(!appSettings.theme) appSettings.theme = 'default';
    } catch(e) { console.error("Error loading settings", e); }
  }
}

window.addEventListener('resize', () => { initCanvas(); applySettings(); });

window.onload = () => {
  loadStoredSettings();
  initCanvas();
  loop();
  applySettings();
  
  const pages = ['home', 'songs', 'videos', 'games', 'books', 'settings'];
  const startPage = appSettings.startPage || 'home';
  const startIndex = pages.indexOf(startPage);
  if(startIndex > -1) {
    showTab(startPage, document.querySelectorAll('.nav-item')[startIndex], startIndex);
  }
};
let audioCtx;
let analyser;
let dataArray;
let sourceNodes = new Map();

function initAudioVisualizer(audioElement) {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 32; // Small size for 4-5 bars
    const bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);
  }

  // Connect the audio element if not already connected
  if (!sourceNodes.has(audioElement)) {
    const source = audioCtx.createMediaElementSource(audioElement);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    sourceNodes.set(audioElement, source);
  }

  function updateBars() {
    if (audioElement.paused) return;
    analyser.getByteFrequencyData(dataArray);
    
    // Find the visualizer bars for THIS specific song
    const container = audioElement.closest('.song-item');
    const bars = container.querySelectorAll('.bar');
    
    bars.forEach((bar, i) => {
      // Map audio frequency to height (min 4px, max 20px)
      const val = dataArray[i] / 255;
      const height = 4 + (val * 16);
      bar.style.height = height + 'px';
    });
    
    requestAnimationFrame(updateBars);
  }
  
  if (audioCtx.state === 'suspended') audioCtx.resume();
  updateBars();
}

// Attach the visualizer to all play events
document.querySelectorAll('audio').forEach(audio => {
  audio.addEventListener('play', () => initAudioVisualizer(audio));
});

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


</script>
</body>
</html>


